<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <title>Fiqh Hub - Shāfiʿī Inheritance & Zakath</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Amiri:wght@400;700&family=Noto+Sans+Malayalam:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', 'Noto Sans Malayalam', sans-serif; 
            background-color: #020617; 
            color: #f1f5f9; 
            overflow-x: hidden; 
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        .arabic { font-family: 'Amiri', serif; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05); 
        }
        .mahjub-card {
            opacity: 0.5;
            filter: grayscale(0.7);
            background: rgba(15, 23, 42, 0.3);
            border-style: dashed !important;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Festive Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        @keyframes glow {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        @keyframes stars {
            0% { opacity: 0.2; }
            50% { opacity: 0.7; }
            100% { opacity: 0.2; }
        }
        .floating-lantern { animation: float 6s ease-in-out infinite; }
        .glowing-moon { filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.4)); }
        .star-field { background-image: radial-gradient(white, rgba(255,255,255,0.2) 2px, transparent 40px); background-size: 100px 100px; animation: stars 4s ease-in-out infinite; }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "recharts": "https://esm.sh/recharts@^3.6.0"
  }
}
</script>
</head>
<body>
    <div id="app"></div>

    <script>
        // --- CONSTANTS ---
        const GOLD_PRICE_FIXED = 13582; // ₹13,582 per gram
        const SILVER_PRICE_EST = 90;    // ₹90 per gram estimate for calc
        const NISAB_GOLD = 85;          // 85 grams
        const NISAB_SILVER = 595;       // 595 grams
        const NISAB_AGRI_KG = 652;      // 5 Wasqs approx 652kg

        // --- DATA & TRANSLATIONS ---
        const TRANSLATIONS = {
            en: { 
                title: "Fiqh Hub", subtitle: "Shāfiʿī Jurisprudence Platform", home: "Home", inheritance: "Inheritance", zakath: "Zakath", faraid: "Fara'id", back: "Back", calculate: "Calculate", 
                estateValue: "Total Estate Value (INR)", estateTotal: "Estate Total", runEngine: "Run Shāfiʿī Engine", wajib: "Wajib (Payable)", exempt: "Below Nisāb", share: "Share", perHead: "Per Individual", 
                blockedBy: "Blocked By", mahjub: "Mahjub", cashSavings: "Cash & Savings (INR)", goldWeight: "Gold Weight (Grams)", businessStock: "Business Stock Value", silverWeight: "Silver Weight (Grams)",
                agriTitle: "Agriculture (Ushr)", agriWeight: "Harvest Weight (kg)", agriType: "Irrigation Type", rainFed: "Rain-fed (10%)", irrigated: "Irrigated (5%)",
                livestockTitle: "Livestock", sheepGoat: "Sheep/Goats", cattle: "Cattle/Cows",
                festGreeting: "Welcome to the Hub", festAction: "Enter Platform",
                cats: { direct: "Direct Heirs", desc: "Descendants", sib: "Siblings", nephew: "Nephews & Extended", cousin: "Paternal Cousins" } 
            },
            ml: { 
                title: "ഫിഖ്ഹ് ഹബ്", subtitle: "ഷാഫിഈ കർമ്മശാസ്ത്രം", home: "ഹോം", inheritance: "അനന്തരാവകാശം", zakath: "സകാത്ത്", faraid: "ഫറാഇദ്", back: "പിന്നിലേക്ക്", calculate: "കണക്കാക്കുക", 
                estateValue: "സ്വത്ത് മൂല്യം (രൂപ)", estateTotal: "ആകെ സ്വത്ത്", runEngine: "കണക്കുകൂട്ടുക", wajib: "നിർബന്ധം (വാജിബ്)", exempt: "നിസാബ് തികഞ്ഞില്ല", share: "വിഹിതം", perHead: "ഒരാൾക്ക്", 
                blockedBy: "തടഞ്ഞത്", mahjub: "ഹജ്ബ്", cashSavings: "പണം & നിക്ഷേപം", goldWeight: "സ്വർണ്ണം (ഗ്രാം)", businessStock: "ബിസിനസ്സ് സ്റ്റോക്ക്", silverWeight: "വെള്ളി (ഗ്രാം)",
                agriTitle: "കൃഷി (ഉശ്ര്)", agriWeight: "വിളവ് (കിലോ)", agriType: "നനയ്ക്കുന്ന രീതി", rainFed: "മഴവെള്ളം (10%)", irrigated: "നനയ്ക്കുന്നത് (5%)",
                livestockTitle: "കന്നുകാലികൾ", sheepGoat: "ആടുകൾ", cattle: "പശുക്കൾ/പോത്തുകൾ",
                festGreeting: "ഫിഖ്ഹ് ഹബ്ബിലേക്ക് സ്വാഗതം", festAction: "പ്രവേശിക്കുക",
                cats: { direct: "നേരിട്ടുള്ള ബന്ധുക്കൾ", desc: "സന്താനങ്ങൾ", sib: "സഹോദരങ്ങൾ", nephew: "സഹോദര പുത്രന്മാർ", cousin: "പിതൃസഹോദര പുത്രന്മാർ" } 
            },
            ar: { 
                title: "ملتقى الفقه", subtitle: "منصة الفقه الشافعي", home: "الرئيسية", inheritance: "المواريث", zakath: "الزكاة", faraid: "الفرائض", back: "رجوع", calculate: "احسب", 
                estateValue: "قيمة التركة الإجمالية", estateTotal: "إجمالي التركة", runEngine: "تشغيل النظام الشافعي", wajib: "واجب", exempt: "دون النصاب", share: "النصيب", perHead: "نصيب الفرد", 
                blockedBy: "حُجب بـ", mahjub: "محجوب", cashSavings: "النقد والمدخرات", goldWeight: "وزن الذهب (جرام)", businessStock: "قيمة البضاعة التجارية", silverWeight: "وزن الفضة (جرام)",
                agriTitle: "الزراعة (العشر)", agriWeight: "وزن المحصول (كجم)", agriType: "نوع الري", rainFed: "بعلي - مطر (10%)", irrigated: "سقي - صناعي (5%)",
                livestockTitle: "الماشية", sheepGoat: "الغنم والماعز", cattle: "البقر والجاموس",
                festGreeting: "أهلاً بكم في ملتقى الفقه", festAction: "دخول المنصة",
                cats: { direct: "الورثة المباشرون", desc: "الفروع", sib: "الإخوة", nephew: "أبناء الإخوة والحواشي", cousin: "أبناء الأعمام" } 
            }
        };

        const HEIR_DATA = {
            husband: { term: "Az-Zawj", en: "Husband", ml: "ഭർത്താവ്", ar: "الزوج", rules: "Legally married. Active marriage or Iddah." },
            wife: { term: "Az-Zawjah", en: "Wife / Wives", ml: "ഭാര്യ / ഭാര്യമാർ", ar: "الزوجة", rules: "Multiple wives share the fixed portion." },
            sons: { term: "Al-Ibn", en: "Son", ml: "മകൻ", ar: "الابن", rules: "Direct male descendant (Agnate)." },
            daughters: { term: "Al-Bint", en: "Daughter", ml: "മകൾ", ar: "البنت", rules: "Direct female descendant." },
            grandsons: { term: "Ibn al-Ibn", en: "Grandson", ml: "മകന്റെ മകൻ", ar: "ابن الابن", rules: "Son's son only." },
            granddaughters: { term: "Bint al-Ibn", en: "Granddaughter", ml: "മകന്റെ മകൾ", ar: "ബنت الابന", rules: "Son's daughter only." },
            father: { term: "Al-Ab", en: "Father", ml: "പിതാവ്", ar: "الأب", rules: "Direct male ascendant." },
            mother: { term: "Al-Umm", en: "Mother", ml: "മാതാവ്", ar: "الأم", rules: "Direct female ascendant." },
            grandfather: { term: "Al-Jadd al-Sahih", en: "Grandfather", ml: "പിതാമഹൻ", ar: "الجد الصحيح", rules: "Paternal grandfather." },
            patGrandmother: { term: "Al-Jaddah li-Ab", en: "Paternal Grandma", ml: "പിതാവിന്റെ മാതാവ്", ar: "الجدة لأب", rules: "Father's mother." },
            matGrandmother: { term: "Al-Jaddah li-Umm", en: "Maternal Grandma", ml: "മാതാവിന്റെ മാതാവ്", ar: "الجدة لأം", rules: "Mother's mother." },
            fullBrothers: { term: "Al-Akh al-Shaqiq", en: "Full Brother", ml: "സഹോദരൻ", ar: "الأخ الشقيق", rules: "Same father and mother." },
            fullSisters: { term: "Al-Ukht al-Shaqiqah", en: "Full Sister", ml: "സഹോദരി", ar: "الأخت الشقيقة", rules: "Same father and mother." },
            patBrothers: { term: "Al-Akh li-Ab", en: "Paternal Brother", ml: "പിതൃസഹോദരൻ", ar: "الأخ لأب", rules: "Same father only." },
            patSisters: { term: "Al-Ukht li-Ab", en: "Paternal Sister", ml: "പിതൃസഹോദരി", ar: "الأخت لأب", rules: "Same father only." },
            matBrothers: { term: "Al-Akh li-Umm", en: "Maternal Brother", ml: "മാതൃസഹോദരൻ", ar: "الأخ لأം", rules: "Same mother only." },
            matSisters: { term: "Al-Ukht li-Umm", en: "Maternal Sister", ml: "മാതൃസഹോദരി", ar: "الأخت لأം", rules: "Same mother only." },
            fullNephews: { term: "Ibn al-Akh al-Shaqiq", en: "Full Nephew", ml: "സഹോദര പുത്രൻ", ar: "ابن الأخ الشقيق", rules: "Full brother's son." },
            patNephews: { term: "Ibn al-Akh li-Ab", en: "Paternal Nephew", ml: "പിതൃസഹോദര പുത്രൻ", ar: "ابن الأخ لأب", rules: "Paternal brother's son." },
            fullNephewSons: { term: "Ibn Ibn al-Akh al-Shaqiq", en: "Full Nephew's Son", ml: "സഹോദരന്റെ പേരക്കുട്ടി", ar: "ابن ابن الأخ الشقيق", rules: "Full brother's grandson." },
            patNephewSons: { term: "Ibn Ibn al-Akh li-Ab", en: "Pat. Nephew's Son", ml: "പിതൃസഹോദരന്റെ പേരക്കുട്ടി", ar: "ابن ابن الأخ لأب", rules: "Paternal brother's grandson." },
            fullPatUncles: { term: "Al-Amm al-Shaqiq", en: "Full Paternal Uncle", ml: "വലിയ പിതാവ് (അമ്മ വഴി)", ar: "العم الشقيق", rules: "Father's full brother." },
            patPatUncles: { term: "Al-Amm li-Ab", en: "Paternal Paternal Uncle", ml: "വലിയ പിതാവ് (അച്ഛൻ വഴി)", ar: "العم لأب", rules: "Father's paternal brother." },
            fullCousins: { term: "Ibn al-Amm al-Shaqiq", en: "Full Cousin", ml: "പിതൃസഹോദര പുത്രൻ", ar: "ابن العم الشقيق", rules: "Father's full brother's son." },
            patCousins: { term: "Ibn al-Amm li-Ab", en: "Paternal Cousin", ml: "പിതൃസഹോദര പുത്രൻ (പിതാവ് വഴി)", ar: "ابن العم لأب", rules: "Father's paternal brother's son." },
            fullCousinSons: { term: "Ibn Ibn al-Amm al-Shaqiq", en: "Full Cousin's Son", ml: "കസിൻറെ മകൻ", ar: "ابن ابن العم الشقيق", rules: "Full cousin's son." },
            patCousinSons: { term: "Ibn Ibn al-Amm li-Ab", en: "Pat. Cousin's Son", ml: "കസിൻറെ മകൻ (പിതാവ് വഴി)", ar: "ابن العم لأب", rules: "Pat. cousin's son." },
            fullCousinGrandsons: { term: "Ibn Ibn Ibn al-Amm al-Shaqiq", en: "Full Cousin's Grandson", ml: "കസിൻറെ പേരക്കുട്ടി", ar: "ابن ابن ابن العم الشقيق", rules: "Full cousin's grandson." },
            patCousinGrandsons: { term: "Ibn Ibn Ibn al-Amm li-Ab", en: "Pat. Cousin's Grandson", ml: "കസിൻറെ പേരക്കുട്ടി (പിതാവ് വഴി)", ar: "ابن العم لأب", rules: "Pat. cousin's grandson." }
        };

        // --- STATE ---
        let state = {
            page: 'splash',
            lang: 'en',
            inputs: {},
            estate: 0,
            results: null,
            zakahInputs: { 
                cash: 0, gold: 0, silver: 0, business: 0, 
                agriWeight: 0, agriType: 'rainFed',
                sheepGoat: 0, cattle: 0
            },
            zakahRes: null
        };

        // --- LOGIC: INHERITANCE ---
        function calculateFaraid(inputs, estate) {
            const h = (id) => inputs[id] || 0;
            const isH = (id) => !!inputs[id];
            let results = [];
            let exclusions = [];
            const addExcl = (id, blocker) => { if (h(id) > 0) exclusions.push({ id, blockedBy: HEIR_DATA[blocker].term }); };
            const hasDescendants = (h('sons') > 0 || h('daughters') > 0 || h('grandsons') > 0 || h('granddaughters') > 0);
            const hasMaleDescendants = (h('sons') > 0 || h('grandsons') > 0);

            if (h('sons') > 0) ['grandsons', 'granddaughters'].forEach(id => addExcl(id, 'sons'));
            if (isH('father')) ['grandfather', 'patGrandmother'].forEach(id => addExcl(id, 'father'));
            if (isH('mother')) ['patGrandmother', 'matGrandmother'].forEach(id => addExcl(id, 'mother'));
            if (isH('father') || hasMaleDescendants) ['fullBrothers', 'fullSisters', 'patBrothers', 'patSisters', 'matBrothers', 'matSisters'].forEach(s => addExcl(s, isH('father') ? 'father' : 'sons'));

            const asabahOrder = ['sons', 'grandsons', 'father', 'grandfather', 'fullBrothers', 'patBrothers', 'fullNephews', 'patNephews', 'fullNephewSons', 'patNephewSons', 'fullPatUncles', 'patPatUncles', 'fullCousins', 'patCousins', 'fullCousinSons', 'patCousinSons', 'fullCousinGrandsons', 'patCousinGrandsons'];
            let topAgnate = null;
            for (let id of asabahOrder) { if (exclusions.some(e => e.id === id)) continue; if (h(id) > 0) { topAgnate = id; break; } }
            if (topAgnate) { asabahOrder.slice(asabahOrder.indexOf(topAgnate) + 1).forEach(id => { if (h(id) > 0 && !exclusions.some(e => e.id === id)) addExcl(id, topAgnate); }); }

            const active = { ...inputs }; exclusions.forEach(e => active[e.id] = 0);
            let totalFixed = 0; const commonD = 24;
            if (active.husband) { const v = hasDescendants ? 6 : 12; results.push({ id: 'husband', f: hasDescendants ? '1/4' : '1/2', p: (v/24)*100 }); totalFixed += v; }
            else if (active.wife > 0) { const v = hasDescendants ? 3 : 6; results.push({ id: 'wife', f: hasDescendants ? '1/8' : '1/4', p: (v/24)*100 }); totalFixed += v; }
            if (active.mother) { const v = hasDescendants ? 4 : 8; results.push({ id: 'mother', f: hasDescendants ? '1/6' : '1/3', p: (v/24)*100 }); totalFixed += v; }
            if (active.father && hasMaleDescendants) { results.push({ id: 'father', f: '1/6', p: (4/24)*100 }); totalFixed += 4; }
            if (active.daughters > 0 && active.sons === 0) { const v = active.daughters === 1 ? 12 : 16; results.push({ id: 'daughters', f: active.daughters === 1 ? '1/2' : '2/3', p: (v/24)*100 }); totalFixed += v; }

            if (totalFixed > commonD) { const f = commonD / totalFixed; results.forEach(r => r.p *= f); }
            let residue = Math.max(0, 100 - results.reduce((acc, r) => acc + r.p, 0));
            if (residue > 0 && topAgnate) {
                const partners = { 'sons':'daughters', 'grandsons':'granddaughters', 'fullBrothers':'fullSisters', 'patBrothers':'patSisters' };
                const partner = partners[topAgnate];
                if (partner && active[partner] > 0) {
                    const units = (active[topAgnate] * 2) + active[partner]; const val = residue / units;
                    results.push({ id: topAgnate, f: 'Asabah', p: val * 2 * active[topAgnate] });
                    results.push({ id: partner, f: 'Asabah', p: val * active[partner] });
                } else {
                    const existing = results.find(r => r.id === topAgnate);
                    if (existing) { existing.p += residue; existing.f += ' + Asabah'; }
                    else results.push({ id: topAgnate, f: 'Asabah', p: residue });
                }
            }
            return { winners: results.map(r => ({ ...r, ...HEIR_DATA[r.id], amount: estate ? (r.p/100)*estate : 0 })), losers: exclusions.map(e => ({ ...e, ...HEIR_DATA[e.id] })) };
        }

        // --- LOGIC: ZAKAH (Expanded) ---
        function calculateZakath() {
            const z = state.zakahInputs;
            const results = {
                wealth: { amount: 0, details: [] },
                agri: { amount: 0, details: [] },
                livestock: { amount: 0, details: [] },
                total: 0
            };

            const goldVal = z.gold * GOLD_PRICE_FIXED;
            const silverVal = z.silver * SILVER_PRICE_EST;
            const cashVal = z.cash;
            const businessVal = z.business;
            const totalWealth = goldVal + silverVal + cashVal + businessVal;
            const nisabValue = NISAB_GOLD * GOLD_PRICE_FIXED;

            if (totalWealth >= nisabValue) {
                results.wealth.amount = totalWealth * 0.025;
                results.wealth.details.push(`2.5% on Wealth (Nisāb Reached: ₹${totalWealth.toLocaleString()})`);
            }

            if (z.agriWeight >= NISAB_AGRI_KG) {
                const rate = z.agriType === 'rainFed' ? 0.1 : 0.05;
                results.agri.amount = z.agriWeight * rate;
                results.agri.details.push(`${rate*100}% of ${z.agriWeight}kg harvest`);
            }

            if (z.sheepGoat >= 40) {
                let sheepTax = 0;
                if (z.sheepGoat <= 120) sheepTax = 1;
                else if (z.sheepGoat <= 200) sheepTax = 2;
                else if (z.sheepGoat <= 300) sheepTax = 3;
                else sheepTax = Math.floor(z.sheepGoat / 100);
                results.livestock.details.push(`${sheepTax} Sheep/Goat(s) from flock of ${z.sheepGoat}`);
            }

            if (z.cattle >= 30) {
                let cowTax = "";
                if (z.cattle <= 39) cowTax = "1 Tabi' (1yr Calf)";
                else if (z.cattle <= 59) cowTax = "1 Musinna (2yr Cow)";
                else cowTax = "Calculated based on 30s and 40s";
                results.livestock.details.push(`${cowTax} from herd of ${z.cattle}`);
            }

            results.total = results.wealth.amount;
            state.zakahRes = results;
            render();
        }

        // --- RENDER FUNCTIONS ---
        function render() {
            const root = document.getElementById('app');
            const t = TRANSLATIONS[state.lang];
            const isAr = state.lang === 'ar';

            if (state.page === 'splash') {
                root.innerHTML = renderSplash(t, isAr);
                lucide.createIcons();
                return;
            }

            root.innerHTML = `
                <div class="min-h-screen flex flex-col ${isAr ? 'arabic' : ''}">
                    ${renderHeader(t, isAr)}
                    <main class="flex-grow w-full max-w-7xl mx-auto p-8 lg:p-12">
                        ${state.page === 'home' ? renderHome(t, isAr) : ''}
                        ${state.page === 'inheritance' ? renderInheritance(t, isAr) : ''}
                        ${state.page === 'zakath' ? renderZakath(t, isAr) : ''}
                    </main>
                </div>
            `;
            lucide.createIcons();
            attachListeners();
        }

        function renderSplash(t, isAr) {
            return `
                <div class="fixed inset-0 bg-[#020617] flex flex-col items-center justify-center p-6 overflow-hidden">
                    <!-- Star field overlay -->
                    <div class="absolute inset-0 star-field opacity-20 pointer-events-none"></div>
                    
                    <!-- Decorative Elements -->
                    <div class="absolute top-20 left-1/2 -translate-x-1/2 floating-lantern glowing-moon">
                        <i data-lucide="moon" size="120" class="text-amber-400"></i>
                    </div>
                    
                    <div class="absolute top-1/4 left-10 floating-lantern" style="animation-delay: 1s">
                        <i data-lucide="sparkles" size="32" class="text-blue-400"></i>
                    </div>
                    <div class="absolute bottom-1/4 right-10 floating-lantern" style="animation-delay: 2s">
                        <i data-lucide="sparkles" size="48" class="text-blue-300"></i>
                    </div>

                    <div class="relative z-10 text-center space-y-16 max-w-2xl">
                        <div class="space-y-4">
                            <h2 class="text-amber-400 text-sm font-black uppercase tracking-[0.5em] animate-fade-in opacity-0" style="animation-delay: 0.5s">Bismillah</h2>
                            <h1 class="text-6xl md:text-8xl font-black text-white tracking-tighter uppercase leading-none animate-fade-in opacity-0" style="animation-delay: 0.8s">${t.festGreeting}</h1>
                            <p class="text-slate-500 font-bold uppercase tracking-widest text-xs animate-fade-in opacity-0" style="animation-delay: 1.1s">${t.subtitle}</p>
                        </div>

                        <div class="animate-fade-in opacity-0" style="animation-delay: 1.4s">
                            <button onclick="navigate('home')" class="group relative px-12 py-6 bg-transparent rounded-full font-black uppercase tracking-[0.4em] text-white border border-amber-400/30 overflow-hidden transition-all hover:border-amber-400 hover:shadow-[0_0_50px_rgba(251,191,36,0.3)]">
                                <span class="relative z-10">${t.festAction}</span>
                                <div class="absolute inset-0 bg-amber-600/10 group-hover:bg-amber-600/20 transition-all"></div>
                            </button>
                        </div>
                    </div>

                    <!-- Bottom Lanterns -->
                    <div class="absolute bottom-10 left-10 floating-lantern opacity-40">
                         <i data-lucide="sun" size="24" class="text-amber-500"></i>
                    </div>
                    <div class="absolute bottom-10 right-10 floating-lantern opacity-40" style="animation-delay: 1.5s">
                         <i data-lucide="sun" size="24" class="text-amber-500"></i>
                    </div>
                </div>
            `;
        }

        function renderHeader(t, isAr) {
            return `
                <header class="bg-slate-900/60 backdrop-blur-xl border-b border-white/10 p-6 sticky top-0 z-50 flex justify-between items-center shadow-xl ${isAr ? 'flex-row-reverse' : ''}">
                    <div onclick="navigate('home')" class="flex items-center gap-4 cursor-pointer group ${isAr ? 'flex-row-reverse' : ''}">
                        <i data-lucide="scale" class="text-blue-400 group-hover:rotate-12 transition-transform"></i>
                        <h1 class="font-black text-2xl tracking-tighter uppercase">${t.title}</h1>
                    </div>
                    <div class="flex bg-slate-950 p-1.5 rounded-2xl border border-white/10 shadow-inner">
                        ${['en','ml','ar'].map(l => `
                            <button onclick="setLang('${l}')" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${state.lang === l ? 'bg-blue-600 text-white shadow-xl' : 'text-slate-500 hover:text-slate-300'}">${l}</button>
                        `).join('')}
                    </div>
                </header>
            `;
        }

        function renderHome(t, isAr) {
            return `
                <div class="space-y-16 animate-fade-in py-10">
                    <section class="text-center">
                        <div class="inline-block p-12 bg-blue-600/10 rounded-[4rem] mb-10 border border-blue-400/20 shadow-2xl">
                            <i data-lucide="scale" size="80" class="text-blue-400"></i>
                        </div>
                        <h1 class="text-7xl font-black text-white uppercase tracking-tighter">${t.title}</h1>
                        <p class="text-xs font-black uppercase tracking-[0.5em] text-blue-400 mt-4">${t.subtitle}</p>
                    </section>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                        <button onclick="navigate('inheritance')" class="p-16 glass-card rounded-[3.5rem] hover:border-blue-400 transition-all text-left shadow-2xl group relative overflow-hidden">
                            <div class="bg-blue-600 p-6 rounded-[1.5rem] mb-10 inline-block group-hover:scale-110 transition-all shadow-lg"><i data-lucide="calculator" size="40"></i></div>
                            <h3 class="text-3xl font-black uppercase tracking-tighter">${t.inheritance}</h3>
                            <p class="text-xs text-slate-500 mt-4 font-black uppercase tracking-widest opacity-60">Complete 29-Relative Engine</p>
                        </button>
                        <button onclick="navigate('zakath')" class="p-16 glass-card rounded-[3.5rem] hover:border-emerald-400 transition-all text-left shadow-2xl group relative overflow-hidden">
                            <div class="bg-emerald-600 p-6 rounded-[1.5rem] mb-10 inline-block group-hover:scale-110 transition-all shadow-lg"><i data-lucide="wallet" size="40"></i></div>
                            <h3 class="text-3xl font-black uppercase tracking-tighter">${t.zakath}</h3>
                            <p class="text-xs text-slate-500 mt-4 font-black uppercase tracking-widest opacity-60">Wealth Purification & Agriculture</p>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderInheritance(t, isAr) {
            if (state.results) return renderResults(t, isAr);
            return `
                <div class="space-y-12 animate-fade-in pb-32">
                    <div class="flex items-center gap-4 ${isAr ? 'flex-row-reverse' : ''}">
                        <button onclick="navigate('home')" class="p-4 bg-slate-900 border border-white/10 rounded-2xl">
                            <i data-lucide="arrow-left" class="${isAr ? 'rotate-180' : ''}"></i>
                        </button>
                        <h2 class="text-4xl font-black uppercase tracking-tighter">${t.inheritance}</h2>
                    </div>
                    <div class="glass-card rounded-[3.5rem] p-10 lg:p-16 space-y-16 shadow-2xl">
                        <div class="max-w-md mx-auto space-y-4 text-center">
                            <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest">${t.estateValue}</label>
                            <input type="number" id="estateInput" class="w-full p-10 bg-slate-950 border border-white/10 rounded-[2.5rem] text-5xl font-black text-center text-white outline-none focus:ring-4 focus:ring-blue-500/20 transition-all" value="${state.estate || ''}" placeholder="0.00" />
                        </div>
                        <div class="space-y-16">
                            ${renderCategory(t.cats.direct, ['husband','wife','father','mother','grandfather','patGrandmother','matGrandmother'], isAr)}
                            ${renderCategory(t.cats.desc, ['sons','daughters','grandsons','granddaughters'], isAr)}
                            ${renderCategory(t.cats.sib, ['fullBrothers','fullSisters','patBrothers','patSisters','matBrothers','matSisters'], isAr)}
                            ${renderCategory(t.cats.nephew, ['fullNephews','patNephews','fullNephewSons','patNephewSons','fullPatUncles','patPatUncles'], isAr)}
                            ${renderCategory(t.cats.cousin, ['fullCousins','patCousins','fullCousinSons','patCousinSons','fullCousinGrandsons','patCousinGrandsons'], isAr)}
                        </div>
                        <button onclick="runCalculation()" class="w-full bg-blue-600 py-10 rounded-[2.5rem] font-black uppercase tracking-[0.4em] text-2xl shadow-2xl hover:bg-blue-500 transition-all active:scale-95">
                            ${t.runEngine}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderCategory(title, ids, isAr) {
            return `
                <div class="space-y-4">
                    <h4 class="text-[10px] font-black text-blue-500 uppercase tracking-[0.3em] pl-4 border-l-4 border-blue-600 ${isAr ? 'text-right pr-4 border-l-0 border-r-4' : ''}">${title}</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        ${ids.map(id => {
                            const isBoolean = ['husband','father','mother','grandfather','patGrandmother','matGrandmother'].includes(id);
                            if (isBoolean) {
                                return `
                                    <button onclick="toggleHeir('${id}')" class="p-6 rounded-[2rem] border flex justify-between items-center transition-all ${state.inputs[id] ? 'bg-blue-600/10 border-blue-400 text-white' : 'bg-slate-950 border-white/5 text-slate-500'}">
                                        <div class="${isAr ? 'text-right' : 'text-left'}">
                                            <div class="text-[11px] font-black uppercase tracking-tight ${isAr ? 'arabic text-lg' : ''}">${HEIR_DATA[id][state.lang]}</div>
                                            <div class="text-[9px] font-bold text-slate-500 uppercase">${HEIR_DATA[id].term}</div>
                                        </div>
                                        <div class="w-5 h-5 rounded-full border-2 ${state.inputs[id] ? 'bg-blue-400 border-blue-400' : 'border-slate-800'}"></div>
                                    </button>
                                `;
                            } else {
                                return `
                                    <div class="p-6 rounded-[2rem] bg-slate-950 border border-white/5 flex flex-col gap-4">
                                        <div class="text-[11px] font-black text-slate-500 uppercase tracking-widest leading-tight ${isAr ? 'text-right' : ''}">
                                            <span class="${isAr ? 'arabic text-white text-lg block mb-1' : 'block mb-1 text-white'}">${HEIR_DATA[id][state.lang]}</span>
                                            <span class="text-[8px] font-bold uppercase">(${HEIR_DATA[id].term})</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <button onclick="adjustHeir('${id}', -1)" class="p-2 bg-slate-900 rounded-lg hover:text-blue-400"><i data-lucide="minus" size="14"></i></button>
                                            <span class="font-black text-xl tracking-tighter">${state.inputs[id] || 0}</span>
                                            <button onclick="adjustHeir('${id}', 1)" class="p-2 bg-slate-900 rounded-lg hover:text-blue-400"><i data-lucide="plus" size="14"></i></button>
                                        </div>
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderResults(t, isAr) {
            return `
                <div class="space-y-10 animate-fade-in pb-32">
                    <button onclick="clearResults()" class="flex items-center gap-2 text-blue-400 font-black uppercase text-xs tracking-widest"><i data-lucide="arrow-left" size="16"></i> ${t.back}</button>
                    <div class="flex flex-col md:flex-row justify-between items-end border-b border-white/5 pb-8 gap-6 ${isAr ? 'flex-row-reverse text-right' : ''}">
                        <h2 class="text-5xl font-black uppercase tracking-tighter">${t.faraid} Report</h2>
                        ${state.estate > 0 ? `<div class="${isAr ? 'text-left' : 'text-right'}"><span class="text-[10px] font-black text-slate-500 uppercase block mb-1">${t.estateTotal}</span><span class="text-4xl font-black text-blue-400">₹${state.estate.toLocaleString()}</span></div>` : ''}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${state.results.winners.map(r => `
                            <div class="p-8 rounded-[2.5rem] glass-card border border-blue-400/20 flex flex-col hover:border-blue-400/40 shadow-2xl transition-all">
                                <div class="flex justify-between items-start mb-4 ${isAr ? 'flex-row-reverse' : ''}">
                                    <div class="${isAr ? 'text-right' : 'text-left'}">
                                        <h3 class="font-black text-xl text-white uppercase tracking-tighter ${isAr ? 'arabic text-2xl' : ''}">${r[state.lang]}</h3>
                                        <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest">(${r.term})</div>
                                    </div>
                                    <div class="${isAr ? 'text-left' : 'text-right'}">
                                        <div class="text-3xl font-black text-blue-400 leading-none">${r.f}</div>
                                        <div class="text-[10px] font-black text-slate-500 mt-1">${r.p.toFixed(2)}%</div>
                                    </div>
                                </div>
                                <p class="text-[9px] text-slate-500 italic mb-6 leading-relaxed ${isAr ? 'text-right' : 'text-left'}">"${r.rules}"</p>
                                ${state.estate > 0 ? `
                                    <div class="mt-auto pt-6 border-t border-white/5 space-y-3">
                                        <div class="flex justify-between items-baseline ${isAr ? 'flex-row-reverse' : ''}">
                                            <span class="text-[9px] font-black text-slate-500 uppercase">${t.share}:</span>
                                            <span class="text-xl font-black text-white">₹${r.amount.toLocaleString(undefined, { maximumFractionDigits: 0 })}</span>
                                        </div>
                                        ${state.inputs[r.id] > 1 ? `
                                            <div class="flex justify-between items-baseline ${isAr ? 'flex-row-reverse' : ''}">
                                                <span class="text-[9px] font-black text-blue-500 uppercase">${t.perHead}:</span>
                                                <span class="text-sm font-black text-blue-400">₹${(r.amount/state.inputs[r.id]).toLocaleString(undefined, { maximumFractionDigits: 0 })}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderZakath(t, isAr) {
            return `
                <div class="space-y-12 animate-fade-in pb-32">
                    <div class="flex items-center gap-4 ${isAr ? 'flex-row-reverse' : ''}">
                        <button onclick="navigate('home')" class="p-4 bg-slate-900 border border-white/10 rounded-2xl"><i data-lucide="arrow-left" class="${isAr ? 'rotate-180' : ''}"></i></button>
                        <h2 class="text-4xl font-black uppercase tracking-tighter">${t.zakath}</h2>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="glass-card rounded-[3.5rem] p-10 space-y-10">
                            <div>
                                <h4 class="text-xs font-black text-blue-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-2"><i data-lucide="coins" size="16"></i> Wealth & Trade</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.cashSavings}</label>
                                        <input type="number" id="zCash" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-blue-500/20" value="${state.zakahInputs.cash || ''}" />
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.goldWeight}</label>
                                        <input type="number" id="zGold" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-blue-500/20" value="${state.zakahInputs.gold || ''}" />
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.businessStock}</label>
                                        <input type="number" id="zBusiness" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-blue-500/20" value="${state.zakahInputs.business || ''}" />
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.silverWeight}</label>
                                        <input type="number" id="zSilver" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-blue-500/20" value="${state.zakahInputs.silver || ''}" />
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-white/5 pt-10">
                                <h4 class="text-xs font-black text-emerald-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-2"><i data-lucide="wheat" size="16"></i> ${t.agriTitle}</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.agriWeight}</label>
                                        <input type="number" id="zAgriWeight" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-emerald-500/20" value="${state.zakahInputs.agriWeight || ''}" />
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.agriType}</label>
                                        <select id="zAgriType" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-sm text-white outline-none focus:ring-4 focus:ring-emerald-500/20 appearance-none">
                                            <option value="rainFed" ${state.zakahInputs.agriType === 'rainFed' ? 'selected' : ''}>${t.rainFed}</option>
                                            <option value="irrigated" ${state.zakahInputs.agriType === 'irrigated' ? 'selected' : ''}>${t.irrigated}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-white/5 pt-10">
                                <h4 class="text-xs font-black text-amber-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-2"><i data-lucide="beef" size="16"></i> ${t.livestockTitle}</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.sheepGoat}</label>
                                        <input type="number" id="zSheep" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-amber-500/20" value="${state.zakahInputs.sheepGoat || ''}" />
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-[9px] font-black text-slate-500 uppercase tracking-widest ml-4">${t.cattle}</label>
                                        <input type="number" id="zCattle" class="w-full p-6 bg-slate-950 border border-white/5 rounded-3xl font-black text-xl text-white outline-none focus:ring-4 focus:ring-amber-500/20" value="${state.zakahInputs.cattle || ''}" />
                                    </div>
                                </div>
                            </div>

                            <button onclick="handleZakahCalc()" class="w-full bg-blue-600 py-8 rounded-[2rem] font-black uppercase tracking-widest text-xl shadow-2xl hover:bg-blue-500 transition-all">
                                ${t.calculate}
                            </button>
                        </div>

                        <div class="space-y-8">
                            <div class="glass-card rounded-[3.5rem] p-10 bg-slate-950/40 border-blue-400/20 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 blur-3xl rounded-full -mr-16 -mt-16"></div>
                                <div class="text-center space-y-6">
                                    <div class="inline-block p-4 bg-blue-600/10 rounded-2xl mb-4 border border-blue-400/20">
                                        <i data-lucide="info" class="text-blue-400"></i>
                                    </div>
                                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.4em]">Current Gold Rate</h3>
                                    <div class="text-5xl font-black text-white tracking-tighter">₹${GOLD_PRICE_FIXED.toLocaleString()} <span class="text-sm font-black text-blue-500 uppercase">/ g</span></div>
                                    <p class="text-[9px] text-slate-500 uppercase font-black tracking-widest">Nisāb (85g): ₹${(NISAB_GOLD * GOLD_PRICE_FIXED).toLocaleString()}</p>
                                </div>
                            </div>

                            ${state.zakahRes ? `
                                <div class="animate-fade-in space-y-6">
                                    <div class="p-10 glass-card rounded-[3.5rem] bg-emerald-600/10 border-emerald-400/20 shadow-2xl">
                                        <h3 class="text-xs font-black text-emerald-400 uppercase tracking-[0.4em] mb-8">Zakah Payable (Currency/Gold)</h3>
                                        <div class="text-7xl font-black text-white tracking-tighter">₹${state.zakahRes.wealth.amount.toLocaleString()}</div>
                                        <div class="mt-8 space-y-2">
                                            ${state.zakahRes.wealth.details.map(d => `<div class="text-[10px] text-slate-400 font-bold uppercase tracking-widest flex items-center gap-2"><div class="w-1.5 h-1.5 rounded-full bg-emerald-400"></div> ${d}</div>`).join('')}
                                        </div>
                                    </div>

                                    ${state.zakahRes.agri.details.length > 0 ? `
                                        <div class="p-10 glass-card rounded-[3.5rem] bg-amber-600/10 border-amber-400/20 shadow-2xl">
                                            <h3 class="text-xs font-black text-amber-400 uppercase tracking-[0.4em] mb-4">${t.agriTitle}</h3>
                                            <div class="text-3xl font-black text-white tracking-tighter">${state.zakahRes.agri.amount.toFixed(1)} kg <span class="text-xs text-slate-500">of produce</span></div>
                                            <div class="mt-4 text-[10px] text-slate-400 font-bold uppercase tracking-widest">${state.zakahRes.agri.details[0]}</div>
                                        </div>
                                    ` : ''}

                                    ${state.zakahRes.livestock.details.length > 0 ? `
                                        <div class="p-10 glass-card rounded-[3.5rem] bg-amber-600/10 border-amber-400/20 shadow-2xl">
                                            <h3 class="text-xs font-black text-amber-400 uppercase tracking-[0.4em] mb-4">${t.livestockTitle}</h3>
                                            <div class="space-y-4">
                                                ${state.zakahRes.livestock.details.map(d => `<div class="text-sm text-white font-black uppercase tracking-tighter border-l-2 border-amber-400 pl-4">${d}</div>`).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : `
                                <div class="p-20 text-center opacity-20">
                                    <i data-lucide="calculator" size="48" class="mx-auto mb-4"></i>
                                    <p class="text-xs font-black uppercase tracking-widest">Run Calculation for Report</p>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- HANDLERS ---
        window.navigate = (page) => { state.page = page; state.results = null; state.zakahRes = null; render(); };
        window.setLang = (lang) => { state.lang = lang; render(); };
        window.toggleHeir = (id) => { state.inputs[id] = !state.inputs[id]; render(); };
        window.adjustHeir = (id, d) => { state.inputs[id] = Math.max(0, (state.inputs[id] || 0) + d); render(); };
        window.runCalculation = () => {
            const inputVal = document.getElementById('estateInput').value;
            state.estate = Number(inputVal);
            state.results = calculateFaraid(state.inputs, state.estate);
            render();
        };
        window.clearResults = () => { state.results = null; render(); };
        
        window.handleZakahCalc = () => {
            state.zakahInputs.cash = Number(document.getElementById('zCash').value);
            state.zakahInputs.gold = Number(document.getElementById('zGold').value);
            state.zakahInputs.silver = Number(document.getElementById('zSilver').value);
            state.zakahInputs.business = Number(document.getElementById('zBusiness').value);
            state.zakahInputs.agriWeight = Number(document.getElementById('zAgriWeight').value);
            state.zakahInputs.agriType = document.getElementById('zAgriType').value;
            state.zakahInputs.sheepGoat = Number(document.getElementById('zSheep').value);
            state.zakahInputs.cattle = Number(document.getElementById('zCattle').value);
            calculateZakath();
        };

        function attachListeners() {
            const estateInp = document.getElementById('estateInput');
            if (estateInp) estateInp.oninput = (e) => { state.estate = Number(e.target.value); };
        }

        // --- INIT ---
        render();
    </script>
</body>
</html>